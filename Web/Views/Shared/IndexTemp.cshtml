<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>@ViewBag.Title</title>
      
    @Styles.Render("~/Content/css")
    @Styles.Render("~/Content/easyui/css")
    @Scripts.Render("~/bundles/modernizr")
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/easyui") 
    
    @RenderSection("stylesHeader", required: false)

    @RenderSection("scriptsHeader", required: false)
     
</head>
    <body> 
        @RenderSection("OperationContent", required: false)
         
        <div id="dialog" title="操作">
        </div>
        
        <div id="LoginWindow" class="easyui-dialog" style="width:300px;height:200px;" closed="true" modal="true" title="登录">
            <iframe scrolling="no" id="openXXXIframe" frameborder="0"  src=""  style="width:100%;height:99.5%;"></iframe>

        </div>

        <table id="fixedGrid">
        </table>
        
        @RenderSection("mainContent", required: false)

        @RenderSection("stylesFooter", required: false)
        @RenderSection("scriptsFooter", required: false)
        <script>
            var lastAjaxCall = { settings: null, jqXHR: null };
            //var loginUrl = "/Login/Index?AJAX_Login=1";
            var loginUrl = '@Url.Action("Index","Login",new{AJAX_Login=1})';
            //... 
            $(document).ready(function() {
                $(document).ajaxError(function(event, jqxhr, settings) {
                    if (jqxhr.status == 401) { 
                         $('#openXXXIframe')[0].src = loginUrl;
                            $('#LoginWindow').dialog('open');
                            lastAjaxCall.jqXHR = jqxhr;
                            lastAjaxCall.settings = settings; 
                    }
                });
            }); 

            function LoginSuccessCallBack() {
                $('#LoginWindow').dialog('close'); 
                 
                if (lastAjaxCall.settings) {
                    $.ajax(lastAjaxCall.settings);
                    lastAjaxCall.settings = null;
                } 
            }

        </script>
    </body>
</html>
